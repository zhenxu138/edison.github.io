<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://zhenxu138.github.io/edison.github.io</id>
    <title>edison&apos;s blog</title>
    <updated>2021-10-15T10:59:41.198Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://zhenxu138.github.io/edison.github.io"/>
    <link rel="self" href="https://zhenxu138.github.io/edison.github.io/atom.xml"/>
    <subtitle>lazy man daily context</subtitle>
    <logo>https://zhenxu138.github.io/edison.github.io/images/avatar.png</logo>
    <icon>https://zhenxu138.github.io/edison.github.io/favicon.ico</icon>
    <rights>All rights reserved 2021, edison&apos;s blog</rights>
    <entry>
        <title type="html"><![CDATA[goå­¦ä¹ -é—­åŒ…ã€å›è°ƒå‡½æ•°]]></title>
        <id>https://zhenxu138.github.io/edison.github.io/post/go-xue-xi-bi-bao-hui-diao-han-shu/</id>
        <link href="https://zhenxu138.github.io/edison.github.io/post/go-xue-xi-bi-bao-hui-diao-han-shu/">
        </link>
        <updated>2021-10-15T07:37:34.000Z</updated>
        <content type="html"><![CDATA[<h4 id="1åŒ¿åå‡½æ•°">1.åŒ¿åå‡½æ•°</h4>
<pre><code class="language-go">    //å¸¦å‚æ•°çš„åŒ¿åå‡½æ•°
    func(i, j int32) { //è‡ªåŠ¨æ¨å¯¼
        fmt.Println(&quot;i= &quot;, i)
        fmt.Println(&quot;j= &quot;, j)
    }(10, 20) //åœ†æ‹¬å·ä»£è¡¨è°ƒç”¨åŒ¿åå‡½æ•°
</code></pre>
<h4 id="2å›è°ƒå‡½æ•°">2.å›è°ƒå‡½æ•°</h4>
<p>å°±æ˜¯è®¾ç½®é€šç”¨æ–¹æ³•ï¼Œæä¾›ä¸€ä¸ªæ¥å£ï¼Œè®©ä½¿ç”¨å¤–éƒ¨å»å®ç°é‡Œé¢çš„å…·ä½“æ–¹æ³•ã€‚</p>
<pre><code>type Callback func(x, y int) int

// æä¾›ä¸€ä¸ªæ¥å£ï¼Œè®©å¤–éƒ¨å»å®ç°
func test(x, y int, callback Callback) int {
    return callback(x, y)
}

// å›è°ƒå‡½æ•°çš„å…·ä½“å®ç°
func add(x, y int) int {
    return x + y
}

func main() {
    x, y := 1, 2
    fmt.Println(test(x, y, add))
}
</code></pre>
<h4 id="3é—­åŒ…">3.é—­åŒ…</h4>
<p>å°±æ˜¯å°†ä¸€ä¸ªå‡½æ•°çš„è¿”å›å€¼ä¸ºå¦ä¸€ä¸ªå‡½æ•°ï¼Œåˆ™å¦ä¸€ä¸ªå‡½æ•°é‡Œçš„å˜é‡å€¼å°±ä¸ä¼šé‡Šæ”¾ï¼Œå­˜è´§å¹¶ç‹¬äº«çŠ¶æ€ä¼šä¸€ç›´åœ¨ç¼“å­˜ä¸­ã€‚</p>
<pre><code>func main() {
    //reså…¶å®å°±æ˜¯test1è¿”å›å€¼å‡½æ•°,å’Œä¹‹å‰åŒ¿åå‡½æ•°å˜é‡ä¸€ä¸ªé“ç†
    res := test1()
    fmt.Println(res()) //è¾“å‡º2
    fmt.Println(res()) //è¾“å‡º3
    fmt.Println(res()) //è¾“å‡º4
}
//æ³¨æ„æ­¤å¤„,è¿”å›å€¼ç±»å‹æ˜¯func int
func test1() func() int {
    i := 1
    return func() int {
        i = i + 1
        return i
    }
}
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ç®—æ³•-äºŒåˆ†æŸ¥æ‰¾]]></title>
        <id>https://zhenxu138.github.io/edison.github.io/post/suan-fa-er-fen-cha-zhao/</id>
        <link href="https://zhenxu138.github.io/edison.github.io/post/suan-fa-er-fen-cha-zhao/">
        </link>
        <updated>2021-10-14T10:37:06.000Z</updated>
        <content type="html"><![CDATA[<p>1.æ€è·¯</p>
<p>2.è§£é¢˜æ­¥éª¤</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ç®—æ³•-åˆ†æ²»æ³•]]></title>
        <id>https://zhenxu138.github.io/edison.github.io/post/suan-fa-fen-zhi-fa/</id>
        <link href="https://zhenxu138.github.io/edison.github.io/post/suan-fa-fen-zhi-fa/">
        </link>
        <updated>2021-10-14T10:32:59.000Z</updated>
        <content type="html"><![CDATA[<p>1.æ€è·¯</p>
<p>2.è§£é¢˜æ­¥éª¤</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[goå­¦ä¹ -å¹¶å‘æ¨¡å‹]]></title>
        <id>https://zhenxu138.github.io/edison.github.io/post/go-bing-fa-mo-xing/</id>
        <link href="https://zhenxu138.github.io/edison.github.io/post/go-bing-fa-mo-xing/">
        </link>
        <updated>2021-10-14T10:21:27.000Z</updated>
        <content type="html"><![CDATA[<h1 id="å¹¶å‘æ¨¡å‹">å¹¶å‘æ¨¡å‹</h1>
<h1 id="1åœºæ™¯">1.åœºæ™¯</h1>
<h5 id="1ä¸‰ä¸ªä»»åŠ¡abåŒæ—¶cå¿…é¡»ç­‰åˆ°abå®Œæˆåæ‰èƒ½è¿›è¡Œ">1.ä¸‰ä¸ªä»»åŠ¡ï¼ŒA,BåŒæ—¶ï¼ŒCå¿…é¡»ç­‰åˆ°A,Bå®Œæˆåæ‰èƒ½è¿›è¡Œã€‚</h5>
<p>è§£æï¼šå‰ä¸¤ä¸ªå¹¶å‘ï¼Œåä¸€ä¸ªç­‰å¾…ã€‚æ‰€ä»¥ä½¿ç”¨sync.WaitGroup</p>
<pre><code class="language-go">	w :=sync.WaitGroup{}
	w.Add(2)
	go func() {
		a()
		w.Done()
	}()
	go func() {
		b()
		w.Done()
	}()
	w.Wait()
	c()
</code></pre>
<p>æ³¨æ„ç‚¹ï¼šdoneå’Œwaitè¦åœ¨å¤–é¢ç¯å¢ƒæ‰§è¡Œ</p>
<p>çŸ¥è¯†ç‚¹ï¼šsync.WaitGroupå¯ä»¥è§£å†³åŒæ­¥é˜»å¡ç­‰å¾…çš„é—®é¢˜ã€‚</p>
<h5 id="2abä¸¤ä¸ªä»»åŠ¡éƒ½éœ€è¦æ‰§è¡Œxä»»åŠ¡ä½†ä¸èƒ½åŒæ—¶åš">2.A,Bä¸¤ä¸ªä»»åŠ¡ï¼Œéƒ½éœ€è¦æ‰§è¡ŒXä»»åŠ¡ï¼Œä½†ä¸èƒ½åŒæ—¶åšã€‚</h5>
<p>è§£æï¼Œä¸¤ä¸ªå¹¶å‘ä»»åŠ¡ï¼Œå¯¹ä¸€ä¸ªèµ„æºä¿¡è¿›è¡ŒæŠ¢å¤ºç­‰å¾…ï¼Œæ‰€ä»¥è¦ä½¿ç”¨é”ï¼Œsync.mutexã€‚</p>
<pre><code class="language-go">	m:=&amp;sync.Mutex{}
	go func() {
		a(m)
	}()
	go func() {
		b(m)
	}()
	time.Sleep(time.Second*8)
	
func a(m *sync.Mutex)  {
	fmt.Println(&quot;a is start&quot;)
	m.Lock()
	c(&quot;a is using c&quot;)
	m.Unlock()
	fmt.Println(&quot;a is done&quot;)
}
func b(m *sync.Mutex)  {
	fmt.Println(&quot;b is start&quot;)
	m.Lock()
	c(&quot;b is using c&quot;)
	m.Unlock()
	fmt.Println(&quot;b is start&quot;)
}
func c(s string)  {
	fmt.Println(s)
	time.Sleep(4*time.Second)
	fmt.Println(s)
}
</code></pre>
<p>æ³¨æ„ç‚¹ï¼šé”æ˜¯æŒ‡é’ˆç±»å‹ï¼Œå¾—ä¼ å¼•ç”¨ã€‚</p>
<p>çŸ¥è¯†ç‚¹ï¼šsync.Mutexå¯ä»¥è§£å†³å¯¹èµ„æºåŒæ­¥é—®é¢˜ã€‚</p>
<h5 id="3abcä¸‰ä¸ªäº‰å¤ºèµ„æºxaåšçš„æ—¶å€™bcä¸èƒ½åš">3.ABC,ä¸‰ä¸ªäº‰å¤ºèµ„æºx.Aåšçš„æ—¶å€™ï¼ŒBCä¸èƒ½åšã€‚</h5>
<p>è§£æï¼šé¦–å…ˆä¹Ÿæ˜¯èµ„æºäº‰å¤ºï¼ŒAåšçš„æ—¶å€™ä¸Šé”ï¼Œå…¶ä»–å¯¹èµ„æºçš„äº‰å¤ºæœ‰é™åˆ¶ï¼Œä¸ºè¯»å†™é”ã€‚</p>
<pre><code class="language-go">func a(m *sync.RWMutex)  {
	fmt.Println(&quot;a is start&quot;)
	m.Lock()
	x(&quot;a is using x&quot;)
	m.Unlock()
	fmt.Println(&quot;a is done&quot;)
}
func b(m *sync.RWMutex)  {
	fmt.Println(&quot;b is start&quot;)
	m.RLock()
	x(&quot;b is using x&quot;)
	m.RUnlock()
	fmt.Println(&quot;b is start&quot;)
}
func c(m *sync.RWMutex)  {
	fmt.Println(&quot;c is start&quot;)
	m.RLock()
	x(&quot;c is using x&quot;)
	m.RUnlock()
	fmt.Println(&quot;c is start&quot;)
}
</code></pre>
<p>æ³¨æ„ç‚¹ï¼šå¦‚æœæ§åˆ¶å‡ ä¸ªæ–¹æ³•å¯¹ä¸€ä¸ªèµ„æºä½¿ç”¨ï¼Œéœ€è¦å¯¹å‡ ä¸ªæ–¹æ³•éƒ½ä½¿ç”¨é”ï¼Œåªæ˜¯é”çš„ç±»å‹ä¸åŒã€‚</p>
<p>çŸ¥è¯†ç‚¹ï¼šé”æ¯”è¯»é”æƒé™é«˜ã€‚åŒä¸€Rlockä¹Ÿæ˜¯åŒæ—¶å¹¶å‘ä½¿ç”¨èµ„æºã€‚</p>
<h4 id="4abä¸¤ä¸ªä»»åŠ¡bä¾èµ–aä¸­çš„æ•°æ®x">4.A,Bä¸¤ä¸ªä»»åŠ¡ï¼ŒBä¾èµ–Aä¸­çš„æ•°æ®xã€‚</h4>
<p>è§£æï¼šä¸¤ä¸ªå¹¶å‘ä¸­çš„æ•°æ®åŒæ­¥é—®é¢˜ã€‚ä¸€èˆ¬ä½¿ç”¨channelæ¥åŒæ­¥å¹¶å‘æ•°æ®ã€‚</p>
<pre><code>	m:=make(chan int)
	go func() {
		a(m)
	}()
	go func() {
		b(m)
	}()
func a(m chan&lt;- int)  {
	fmt.Println(&quot;a is start&quot;)
	time.Sleep(4*time.Second)
	m&lt;- 1
	fmt.Println(&quot;a is 1&quot;)
}
func b(m &lt;-chan int)  {
	fmt.Println(&quot;b is start&quot;)
	b:= &lt;- m
	fmt.Println(&quot;b get a :&quot;,b)
}
</code></pre>
<p>æ³¨æ„ç‚¹ï¼šchanéœ€è¦èµ‹å€¼ï¼Œæœ‰å†…å­˜åœ°å€ï¼Œnewä¸€ä¸ªã€‚æ‰èƒ½è¯»å–ã€‚</p>
<p>çŸ¥è¯†ç‚¹ï¼šchannelä½¿ç”¨è¦çŸ¥é“å“ªé‡Œç»“æŸï¼ŒåŒæ­¥çš„æ—¶å€™ï¼Œchanå¯ä»¥è½¬æ¢ä¸ºåªè¯»å’Œåªå†™ã€‚</p>
<h4 id="5ä¸€ä¸ªä»»åŠ¡æœ‰abä¸¤ä¸ªåŠŸèƒ½ä½†æ˜¯aåŠŸèƒ½ä¸ç¨³å®šè¶…è¿‡3ç§’å°±ç»“æŸæ–¹æ³•é€€å‡ºæ–¹æ³•">5.ä¸€ä¸ªä»»åŠ¡æœ‰A,Bä¸¤ä¸ªåŠŸèƒ½ï¼Œä½†æ˜¯AåŠŸèƒ½ä¸ç¨³å®šï¼Œè¶…è¿‡3ç§’å°±ç»“æŸæ–¹æ³•ï¼Œé€€å‡ºæ–¹æ³•ã€‚</h4>
<p>è§£æï¼šå› ä¸ºä¸¤ä¸ªåŠŸèƒ½ï¼Œæ‰€ä»¥æœ‰æ•°æ®åŒæ­¥ï¼Œä½¿ç”¨channelã€‚æœ‰ä¸€ä¸ªå¯ä»¥å–æ¶ˆï¼Œæ‰€ä»¥å¯ä»¥å®šä¹‰ä¸ªquitç®¡é“ï¼Œä¸“é—¨å¤„ç†å¼‚å¸¸é€€å‡ºã€‚</p>
<pre><code class="language-go">func A()  {
	cancel:=time.After(3*time.Second)
	done:=make(chan int)
	go x(done)

	select {
	case &lt;-done:
		fmt.Println(&quot;get data success!&quot;)
		return
	case &lt;-cancel:
		fmt.Println(&quot;time out.&quot;)
		return
	}
}
func B()  {
	fmt.Println(&quot;b is start&quot;)
	time.Sleep(5*time.Second)
	//b:= &lt;- m
	fmt.Println(&quot;b get a &quot;)
}
func x(done chan int)  {
	time.Sleep(4*time.Second)
	done&lt;- 1
	fmt.Println(&quot;x spend 4 seconds.&quot;)
}
</code></pre>
<p>æ³¨æ„ç‚¹ï¼šåœ¨Aæ–¹æ³•é‡Œï¼Œå®ç°ä¸¤ä¸ªchannelï¼Œä¸€ä¸ªè®¾ç½®æ—¶é—´è¶…æ—¶ï¼Œä¸€ä¸ªç”¨æ¥å¤„ç†æ•°æ®æ–¹æ³•ã€‚å†ç”¨selectåˆ¤æ–­å“ªä¸ªå¯ä»¥æ‰§è¡Œã€‚</p>
<p>çŸ¥è¯†ç‚¹ï¼šä½¿ç”¨chanå’Œselectæ­é…æ¥æ”¯æŒä¼˜é›…çš„é€€å‡ºè¿‡ç¨‹ï¼Œé€€å‡ºçš„æ–¹æ³•åœ¨å†™å¹¶å‘çš„æ—¶å€™ä¸€å®šè¦å…ˆç¡®å®šå¥½ï¼Œä¿æŒç³»ç»Ÿç¨³å®šã€‚</p>
<h4 id="6ä¸€ä¸ªå·¥ä½œéœ€è¦å¤„ç†nä¸ªaæ–¹æ³•ä½†æ˜¯ä¸€æ¬¡å¤„ç†å¤ªå¤šä¼šå¯¼è‡´æ•ˆç‡é—®é¢˜æ‰€ä»¥è®¾ç½®æ¯æ¬¡åªå¤„ç†10ä¸ª-ä½¿ç”¨æœ‰ç¼“å­˜çš„channel">6.ä¸€ä¸ªå·¥ä½œéœ€è¦å¤„ç†Nä¸ªAæ–¹æ³•ï¼Œä½†æ˜¯ä¸€æ¬¡å¤„ç†å¤ªå¤šä¼šå¯¼è‡´æ•ˆç‡é—®é¢˜ï¼Œæ‰€ä»¥è®¾ç½®æ¯æ¬¡åªå¤„ç†10ä¸ªã€‚ä½¿ç”¨æœ‰ç¼“å­˜çš„channelã€‚</h4>
<pre><code class="language-go">func A(i int) {
    fmt.Println(&quot;task A &quot;, i)
    time.Sleep(time.Second )
}
func main() {
     done := make(chan int, 10)
     for i := 0; i &lt; 100; i ++ {
        go func(i int) {
            done &lt;- 1
            A(i)
            &lt;-done
        }(i)
    }
     time.Sleep(time.Minute)
}
æˆ–è€…
func A(i chan int)  {
	time.Sleep(4*time.Second)
	fmt.Println(&quot;task i:&quot;,&lt;-i)
}
	done:=make(chan int,10)
	for i:=0;i&lt;40;i++{
		go func(i int) {
			//fmt.Println(&quot;i:&quot;,i)
			done&lt;- i
			A(done)
		}(i)
	}
</code></pre>
<p>æ³¨æ„ç‚¹ï¼šç¼“å­˜çš„channelè¦æœ€å…ˆå®šä¹‰ï¼Œ</p>
<p>çŸ¥è¯†ç‚¹ï¼šä½¿ç”¨ç¼“å­˜å¯ä»¥æ§åˆ¶å¹¶å‘é‡ã€‚</p>
<h1 id="2å¹¶å‘æ¨¡å¼">2.å¹¶å‘æ¨¡å¼</h1>
<h4 id="1ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹">1.ç”Ÿäº§è€…ï¼Œæ¶ˆè´¹è€…æ¨¡å‹</h4>
<p>è§£æï¼šå°±æ˜¯ä¸¤æ–¹è§£è€¦ï¼Œä¸€è¾¹ç”Ÿæˆæ•°æ®ï¼Œä¸€è¾¹ä½¿ç”¨æ•°æ®ã€‚ä½¿ç”¨æœ‰ç¼“å­˜çš„channelã€‚</p>
<pre><code class="language-go">	done:=make(chan int,10)

	go A(done)
	for i:=0;i&lt;40;i++ {
		go B(done)
	}
func A(ch chan&lt;- int)  {
	for i:=0;i&lt;40;i++{
		ch&lt;-i*100
		fmt.Println(&quot;task A:&quot;,i)
        }
}
func B(ch &lt;-chan int)  {
	temp:=&lt;-ch
	time.Sleep(4*time.Second)
	fmt.Println(&quot;task B:&quot;,temp)
}
</code></pre>
<p>æ³¨æ„ç‚¹ï¼šgo åœ¨forå‰é¢å’Œforåé¢æ˜¯æœ‰åŒºåˆ«çš„ï¼Œgo forçš„è¯æ˜¯ä¸²è¡Œï¼Œfor goæ‰æ˜¯å¹¶è¡Œã€‚</p>
<p>çŸ¥è¯†ç‚¹ï¼šä¸€ä¸ªäº§ç”Ÿï¼Œä¸€ä¸ªæ¶ˆè´¹ï¼Œchannelä½œä¸ºç¼“å­˜é˜Ÿåˆ—ã€‚</p>
<h4 id="2å‘å¸ƒè®¢é˜…">2.å‘å¸ƒè®¢é˜…</h4>
<p>è§£æï¼šç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ˜¯M:Nçš„å…³ç³»ã€‚åœ¨ä¼ ç»Ÿç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å‹ä¸­ï¼Œæ˜¯å°†æ¶ˆæ¯å‘é€åˆ°ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œè€Œå‘å¸ƒè®¢é˜…æ¨¡å‹åˆ™æ˜¯å°†æ¶ˆæ¯å‘å¸ƒç»™ä¸€ä¸ªä¸»é¢˜ã€‚</p>
<p>æ¯ä¸ªè®¢é˜…è€…å°±æ˜¯å¢åŠ ä¸€ä¸ªchannelï¼Œæ¯æ¬¡å‘ä¸»é¢˜å°±æ˜¯æ¶ˆæ¯å°±ä»channelé‡Œå†™æ•°æ®ã€‚</p>
<pre><code class="language-go">type (
	subscriber chan interface{}		//è®¢é˜…è€…ä¸ºä¸€ä¸ªç®¡é“
)

type Publisher struct {
	m sync.RWMutex
	buffer int
	timeout time.Duration
	subscribers map[subscriber]string
}

//æ–°å»ºä¸€ä¸ªå‘å¸ƒè€…
func NewPublisher(Timeout time.Duration, buffer int) *Publisher {
	return &amp;Publisher{
		m: sync.RWMutex{},
		buffer: buffer,
		timeout: Timeout,
		subscribers: map[subscriber]string{},
	}
}

//è®¢é˜…è€…è®¢é˜…,å°±æ˜¯å¢åŠ mapé‡Œçš„channel
func (p *Publisher)subscrib(topic string) chan interface{} {
	ch:=make(chan interface{},p.buffer)
	p.subscribers[ch]= topic
	return ch
}

//é€€å‡ºè®¢é˜…,åˆ é™¤mapé‡Œçš„channel
func (p *Publisher)Evistsubscrib(sub chan interface{}) {
	delete(p.subscribers,sub)
	close(sub)
}
//å‘å¸ƒä¸»é¢˜
func (p *Publisher)Publish(sub chan interface{}) {
	wg:=sync.WaitGroup{}
	for sub,topic:=range p.subscribers{
		wg.Add(1)
		go sendTopic(sub,topic,&amp;wg,p.timeout)
	}
	wg.Wait()
}
//å‘é€ä¸»é¢˜
func sendTopic(ch chan interface{},topic string,wg *sync.WaitGroup,duration time.Duration)  {
	defer wg.Done()
	select {
	case ch&lt;-topic:
	case &lt;-time.After(duration):
	}
}
</code></pre>
<h1 id="3ç­”ç–‘">3.ç­”ç–‘</h1>
<p><strong>1.ä»€ä¹ˆæ—¶å€™è¦é€‰æ‹©å…³é—­é€šé“ï¼Œéå†ä¸€ä¸ªæœªå…³é—­çš„channelä¼šé€ æˆæ­»å¾ªç¯.ä½†åªè¦æ²¡æœ‰goroutineæŒæœ‰channelï¼Œç›¸å…³èµ„æºä¼šè‡ªåŠ¨é‡Šæ”¾</strong></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[æ•°æ®åº“å­¦ä¹ -SORMç»„ä»¶å­¦ä¹ ]]></title>
        <id>https://zhenxu138.github.io/edison.github.io/post/shu-ju-ku-xue-xi-sorm-zu-jian-xue-xi/</id>
        <link href="https://zhenxu138.github.io/edison.github.io/post/shu-ju-ku-xue-xi-sorm-zu-jian-xue-xi/">
        </link>
        <updated>2021-10-14T09:08:28.000Z</updated>
        <content type="html"><![CDATA[<p>å…¬å…±ç»„ä»¶åšäº†æ•°æ®åº“æŠ½è±¡å±‚ï¼šsormï¼Œæ‰€ä»¥ä¸šåŠ¡ä¸ç›´æ¥å†™æ•°æ®åº“åŸç”Ÿçš„sqlï¼Œéµå¾ªsormç»„ä»¶è¯­æ³•å¼€å‘</p>
<h3 id="1æ¨¡å‹çš„æ¦‚å¿µ">1.æ¨¡å‹çš„æ¦‚å¿µï¼š</h3>
<p>æ¨¡å‹å°±æ˜¯æ•°æ®åº“çš„<mark>è¡¨ç»“æ„</mark>ï¼Œå¯¹åº”åˆ°goä¸­å°±æ˜¯goçš„ç»“æ„ä½“ï¼Œå¯ä»¥é€šè¿‡ç»™ç»“æ„ä½“å¢åŠ ormå±æ€§çš„tagæ¥æŒ‡å®šè¿™ä¸ªå­—æ®µçš„å±æ€§ï¼Œæ¯”å¦‚ä¸»é”®,ç´¢å¼•ç­‰ã€‚</p>
<pre><code class="language-go">type TessResultDetail struct {
   Id       int64  `orm:&quot;pk;column(_id)&quot; bson:&quot;_id&quot;`
   ResultId int64  `orm:&quot;index;column(result_id)&quot; bson:&quot;result_id&quot;`
   CheckId  string `orm:&quot;index;column(check_id)&quot; bson:&quot;check_id&quot; `
   Name     string `orm:&quot;column(name)&quot; bson:&quot;name&quot; json:&quot;name&quot;`
   Score int32 `bson:&quot;score&quot; json:&quot;score&quot;`
   Scope int32 `bson:&quot;scope&quot; json:&quot;scope&quot;`
   CheckStd string `bson:&quot;check_std&quot; json:&quot;check_std&quot;`
   Result int32 `bson:&quot;result&quot; json:&quot;result&quot;` 
   Description  string `bson:&quot;description&quot; json:&quot;description&quot;`
   Extend       string `bson:&quot;extend&quot; json:&quot;extend&quot;`
   CheckContent string `bson:&quot;check_content&quot; json:&quot;check_content&quot;`
}
</code></pre>
<p>æ¨¡å‹åˆå§‹åŒ–ï¼Œæ¨¡å‹æ³¨å†Œ</p>
<pre><code class="language-go">func init() {
  	orm.RegisterModel(new(model.TessResultDetail))
    o := orm.NewOrmWithDb(provider.DefaultDB())
    o.RegisterTable(new(model.TessResultDetail))
}
</code></pre>
<p>ORMæ¨¡å‹å¯¹è±¡çš„ç»„æˆï¼š</p>
<ul>
<li>è¡¨åtable</li>
<li>ä¸»é”®</li>
<li>ç´¢å¼•ï¼ˆæ™®é€šç´¢å¼•ï¼ŒUNIQUE ç´¢å¼•ï¼Œç»„åˆç´¢å¼•ï¼‰</li>
<li>è¡¨åˆ—ï¼ˆåˆ—åï¼‰</li>
<li>å…³è”è¡¨å¯¹è±¡</li>
<li>æ”¯æŒçš„æ•°æ®ç±»å‹ä»¥åŠæ ‡æ³¨</li>
</ul>
<h5 id="æ•°æ®åº“æ³¨å†Œ">æ•°æ®åº“æ³¨å†Œ</h5>
<pre><code>//æ³¨å†Œæ•°æ®åº“ç¤ºä¾‹ï¼š
var info orm.OrmDbRegisterInfo
info.DbType = &quot;mongo&quot;
info.Host = &quot;127.0.0.1:27017&quot;
...
info.AliasName = &quot;default&quot;//å¿…é¡»æŒ‡å®šä¸€ä¸ªdefaultæ•°æ®åº“ï¼Œé€šè¿‡è¿™é‡Œçš„åˆ«åå®ç°
initSetting := make(map[string]string)
initSetting[&quot;create_table&quot;] = &quot;true&quot;
info.Opts = initSetting//è®¾ç½®é€‰é¡¹
 
orm.RegisterDataBaseWithOpt(info)
</code></pre>
<h2 id="2åŸºæœ¬api">2.åŸºæœ¬API</h2>
<h4 id="æŸ¥æ‰¾read">æŸ¥æ‰¾read</h4>
<h5 id="1æ ¹æ®æŸä¸€å€¼æŸ¥æ‰¾å•æ¡æ•°æ®func-o-orm-readone-value-interface-fields-string-error">1.æ ¹æ®æŸä¸€å€¼æŸ¥æ‰¾å•æ¡æ•°æ®ï¼šfunc ( o *orm ) ReadOne (value interface{} , fields ... string ) error</h5>
<pre><code class="language-go">user := User{UId: &quot;100001199508049527&quot;}
err = o.ReadOne(&amp;user,&quot;UId&quot;)

sd := &amp;model.Standard{Id: id}
err := orm.NewOrmWithDb(s.hook.DefaultDB()).ReadOne(sd, &quot;_id&quot;)
</code></pre>
<h5 id="2æŸ¥æ‰¾æˆ–åˆ›é€ funco-orm-readoneorcreate-value-interface-field1-string-fields-string-bool-error">2.æŸ¥æ‰¾æˆ–åˆ›é€ ï¼šfunc(o *orm) ReadOneOrCreate (value interface{}, field1 string, fields ...string) (bool, error)</h5>
<pre><code class="language-go">o := orm.NewOrm()
user := User{Name: &quot;Jeff&quot;}
user := User{UId: &quot;100001199508049527&quot;}
if created, err := o.ReadOneOrCreate(&amp;user, &quot;UId&quot;); err == nil {
  if created {
    fmt.Println(&quot;New Insert an object. Id:&quot;, id)
  } else{
    fmt.Println(&quot;Get an object. Id:&quot;, id)
  }
}
</code></pre>
<h4 id="æ’å…¥æ•°æ®">æ’å…¥æ•°æ®</h4>
<h5 id="1æ’å…¥ä¸€æ¡æ•°æ®func-o-orm-insertvalue-interface-error">1.æ’å…¥ä¸€æ¡æ•°æ®ï¼šfunc( o *orm )Insert(value interface{}) error</h5>
<pre><code class="language-go">var user User
user.Name = &quot;Jack&quot;
err := o.Insert(&amp;user)

standar := model.NewStandard(id, name, assetID, desc, creator, clientType, isInner)
err := orm.NewOrmWithDb(s.hook.DefaultDB()).Insert(standar)
</code></pre>
<h5 id="2æ’å…¥å¤šæ¡func-o-orm-insertmultiint-bulkvalues-interface-opt-ormorminsertmultiopt-int64error">2.æ’å…¥å¤šæ¡ï¼šfunc( o *orm )InsertMulti(int bulk,values [] interface{}, opt ...orm.OrmInsertMultiOpt) (int64,error)</h5>
<pre><code class="language-go">users := []User{
  {Name: &quot;Jack&quot;},
  {Name: &quot;Bob&quot;},
  {Name: &quot;unknown&quot;},
  ...
}
successNums, err := o.InsertMulti(len(users), &amp;users)
</code></pre>
<h4 id="æ›´æ”¹æ•°æ®">æ›´æ”¹æ•°æ®</h4>
<h5 id="1æ›´æ”¹å•æ¡æ•°æ®func-o-orm-updatevalue-interface-fields-string-int64-error">1.æ›´æ”¹å•æ¡æ•°æ®ï¼šfunc ( o *orm )Update(value interface{} , fields ... string )(int64, error)</h5>
<pre><code class="language-go">//æ›´æ–°å…¨éƒ¨å­—æ®µ
o := orm.NewOrm()
user := User{ID: &quot;1&quot;}
if o.Read(&amp;user) == nil {
  user.Name = &quot;MyName&quot;
  if num, err := o.Update(&amp;user); err == nil {
    fmt.Println(num)
  }
}
</code></pre>
<h5 id="2æ›´æ”¹å•æ¡æ•°æ®çš„æŸä¸ªæ•°æ®">2.æ›´æ”¹å•æ¡æ•°æ®çš„æŸä¸ªæ•°æ®</h5>
<pre><code class="language-go">o.Update(&amp;user, &quot;Name&quot;)
// æŒ‡å®šå¤šä¸ªå­—æ®µ
// o.Update(&amp;user, &quot;Field1&quot;, &quot;Field2&quot;, ...)
</code></pre>
<h5 id="3æ’å…¥æˆ–æ›´æ”¹func-s-orm-insertorupdatemd-interface-uniquecols-string-updatecols-string-error">3.æ’å…¥æˆ–æ›´æ”¹ï¼šfunc (s *Orm) InsertOrUpdate(md interface{}, uniquecols []string, updatecols ...string) error</h5>
<pre><code>//æ ¹æ®è”åˆå”¯ä¸€ç´¢å¼•Name å’Œ Age åŒ¹é…ï¼Œè‹¥æ•°æ®åº“å­˜åœ¨åˆ™æ›´æ–°æ‰€æœ‰å­—æ®µï¼Œå¦åˆ™æ’å…¥è¯¥æ¡æ•°æ®
err := o.InsertOrUpdate(intnew, []string{&quot;Name&quot;, &quot;Age&quot;})
</code></pre>
<pre><code class="language-go">//æ ¹æ®è”åˆå”¯ä¸€ç´¢å¼•Name å’Œ Age åŒ¹é…ï¼Œè‹¥æ•°æ®åº“å­˜åœ¨,åªæ›´æ–°&quot;Addr&quot;, &quot;Level&quot;å­—æ®µï¼Œå¦åˆ™æ’å…¥è¯¥æ¡æ•°æ®
err = o.InsertOrUpdate(intnew, []string{&quot;Name&quot;, &quot;Age&quot;}, []string{&quot;Addr&quot;,&quot;Level&quot;}...)
</code></pre>
<h4 id="åˆ é™¤æ•°æ®">åˆ é™¤æ•°æ®</h4>
<h5 id="1åˆ é™¤-funco-orm-deletevalue-interface-erroræ ¹æ®ä¸»é”®è¿›è¡Œåˆ é™¤">1.åˆ é™¤ï¼š func(o *orm) Delete(value interface{}) error//æ ¹æ®ä¸»é”®è¿›è¡Œåˆ é™¤</h5>
<pre><code class="language-go">o := orm.NewOrm()
user := User{UId: ``&quot;100001199508049527&quot;``}
o.ReadOne(&amp;user, ``&quot;UId&quot;``)
err:= o.Delete(user)
if err != nil{
  fmt.Println(err)
}
</code></pre>
<h3 id="3å¤æ‚æŸ¥è¯¢querytable">3.å¤æ‚æŸ¥è¯¢QueryTable</h3>
<pre><code>type User struct {
    ID   string `orm:&quot;pk&quot;`
    Name string
}
//ä½¿ç”¨ç»“æ„ä½“å¯¹è±¡
var user User
qs :=orm.NewOrm().QueryTable(user)
//ä½¿ç”¨ç»“æ„ä½“æŒ‡é’ˆ
if qs == nil {
  log.Errorf(&quot;QueryTable got QuerySet nil&quot;)
}
user := new(User)
qs :=orm.NewOrm().QueryTable(user)
if qs == nil {
    log.Errorf(&quot;QueryTable got QuerySet nil&quot;)
}
</code></pre>
<h4 id="1-withfilteræ“ä½œèŒƒå›´ç¬¦">1. WithFilteræ“ä½œèŒƒå›´ç¬¦</h4>
<h5 id="exactç­‰äº">exactç­‰äº</h5>
<pre><code>qs.WithFilter(&quot;name__exact&quot;, &quot;Jack&quot;) // WHERE name = 'Jack'
</code></pre>
<h5 id="neä¸ç­‰äº">neä¸ç­‰äº</h5>
<pre><code>qs.WithFilter(``&quot;age__ne&quot;``, 17)// WHERE age != 17
</code></pre>
<h5 id="gt-gte-å¤§äº-å¤§äºç­‰äº">gt / gte å¤§äº / å¤§äºç­‰äº</h5>
<pre><code>qs.WithFilter(``&quot;age__gt&quot;``, 17)``// WHERE age &gt; 17` 
qs.WithFilter(``&quot;age__gte&quot;``, 18)``// WHERE age &gt;= 18
</code></pre>
<h5 id="lt-lte-å°äº-å°äºç­‰äº">lt / lte å°äº / å°äºç­‰äº</h5>
<pre><code>qs.WithFilter(``&quot;age__lt&quot;``, 17)// WHERE age &lt; 17
</code></pre>
<pre><code>qs.WithFilter(``&quot;age__lte&quot;``, 18)// WHERE age &lt;= 18
</code></pre>
<h5 id="containsicontains-åŒ…å«">contains/icontains åŒ…å«</h5>
<pre><code>qs.WithFilter(``&quot;name__contains&quot;``, ``&quot;Jack&quot;``)``// å¤§å°å†™æ•æ„Ÿ, åŒ¹é…åŒ…å« Jackçš„å­—ç¬¦qs.WithFilter(``&quot;name__icontains&quot;``, ``&quot;JACK&quot;``)``// ä¸åŒºåˆ†å¤§å°å†™, åŒ¹é…åŒ…å« Jackçš„å­—ç¬¦
</code></pre>
<h5 id="startwithistartwithä»¥-èµ·å§‹">startwith/istartwithä»¥ã€‚ã€‚ã€‚èµ·å§‹</h5>
<pre><code>qs.WithFilter(``&quot;name__startwith&quot;``, ``&quot;Jack&quot;``)// å¤§å°å†™æ•æ„Ÿ, åŒ¹é…ä»¥ 'Jack' èµ·å§‹çš„å­—ç¬¦ä¸²
qs.WithFilter(``&quot;name__istartwith&quot;``, ``&quot;JACK&quot;``)// ä¸åŒºåˆ†å¤§å°å†™, åŒ¹é…ä»¥ 'Jack' èµ·å§‹çš„å­—ç¬¦ä¸²
</code></pre>
<h5 id="endwithiendwith-ä»¥-ç»“æŸ">endwith/iendwith ä»¥ã€‚ã€‚ç»“æŸ</h5>
<pre><code>qs.WithFilter(``&quot;name__endwith&quot;``, ``&quot;Jack&quot;``)``// å¤§å°å†™æ•æ„Ÿ, åŒ¹é…ä»¥ 'Jack' ç»“æŸçš„å­—ç¬¦ä¸²qs.WithFilter(``&quot;name__endwith&quot;``, ``&quot;JACK&quot;``)``// ä¸åŒºåˆ†å¤§å°å†™, åŒ¹é…ä»¥ 'Jack' ç»“æŸçš„å­—ç¬¦ä¸²
</code></pre>
<h5 id="inåœ¨é›†åˆä¸­">inåœ¨é›†åˆä¸­</h5>
<pre><code>ids:=[]``int``{17,18,19,20}``qs.WithFilter(``&quot;age__in&quot;``, ids)``// WHERE age IN (17, 18, 19, 20)
</code></pre>
<h4 id="2withfilterè¿‡æ»¤æŸ¥è¯¢">2.<strong>WithFilter</strong>è¿‡æ»¤æŸ¥è¯¢</h4>
<h5 id="countæŸ¥è¯¢è¿”å›æ•°é‡">countï¼šæŸ¥è¯¢è¿”å›æ•°é‡</h5>
<pre><code>qs := orm.QueryTable(``new``(User))
qs := qs.WithFilter(&quot;name&quot;``, ``&quot;Jack&quot;``)
num,err := qs.Count())
</code></pre>
<h5 id="allè¿”å›ç»“æœé›†ç»“æœåˆ‡ç‰‡">allï¼šè¿”å›ç»“æœé›†ï¼ˆç»“æœåˆ‡ç‰‡ï¼‰</h5>
<pre><code>qs := orm.QueryTable(``new``(User))``
qs := qs.WithFilter(``&quot;name&quot;``, ``&quot;Jack&quot;``)`
`var users []*User``
num,err := qs.All(&amp;users,``&quot;name&quot;``)
</code></pre>
<h5 id="oneæŸ¥è¯¢ç»“æ„é›†ä¸­çš„å•æ¡è®°å½•">oneï¼šæŸ¥è¯¢ç»“æ„é›†ä¸­çš„å•æ¡è®°å½•ã€‚</h5>
<h5 id="oneautolncå¯¹ç»“æœé›†å•æ¡è®°å½•">oneAutolnc:å¯¹ç»“æœé›†å•æ¡è®°å½•</h5>
<h5 id="withorderbyå¯¹æŸ¥è¯¢ç»“æœé›†è¿›è¡Œæ’åº">withorderby:å¯¹æŸ¥è¯¢ç»“æœé›†è¿›è¡Œæ’åº</h5>
<h5 id="withlimité™åˆ¶æ•°æ®æ¡æ•°å’Œåç§»">withlimit:é™åˆ¶æ•°æ®æ¡æ•°å’Œåç§»</h5>
<pre><code class="language-go">QueryTable(new(model.TessResult)).WithFilter(&quot;mid&quot;, mid).WithLimit(1, 0).WithOrderBy(&quot;created_at&quot;, -1).One(info)
</code></pre>
<h5 id="distinctæŸ¥è¯¢ä¸é‡å¤çš„">Distinct:æŸ¥è¯¢ä¸é‡å¤çš„</h5>
<h5 id="newgroupbyåˆ†ç»„æ“ä½œfunc-s-queryset-newgroupsgroupbycols-string-groups">Newgroupbyï¼šåˆ†ç»„æ“ä½œ=func (s *QuerySet) NewGroups(groupByCols []string) *Groups</h5>
<pre><code>qs := orm.QueryTable(new(User))
qs := qs.WithFilter(``&quot;name&quot;``, ``&quot;Jack&quot;)//Countèšåˆæ“ä½œrs,err := qs.NewGroups([]string{``&quot;age&quot;``}).Count()``//Sumèšåˆæ“ä½œ//rs,err := qs.NewGroups([]string{&quot;age&quot;}).Sum(&quot;salary&quot;)``//Maxèšåˆæ“ä½œ``//rs,err := qs.NewGroups([]string{&quot;age&quot;}).Max(&quot;salary&quot;)``//Minèšåˆæ“ä½œ``//rs,err := qs.NewGroups([]string{&quot;age&quot;}).Min(&quot;salary&quot;)``//Avgèšåˆæ“ä½œ``//rs,err := qs.NewGroups([]string{&quot;age&quot;}).Avg(&quot;salary&quot;)
</code></pre>
<h5 id="qsupdateæ‰¹é‡æ›´æ–°func-s-queryset-qsupdatevalues-mapstringinterface-int64-error">QsUpdateï¼šæ‰¹é‡æ›´æ–°==func (s *QuerySet) QsUpdate(values map[string]interface{}) (int64, error)</h5>
<pre><code>val := make(map[string]interface{})``
val[``&quot;name&quot;``] = ``&quot;Bob&quot;``
num, err := o.QueryTable(``new``(User)).WithFilter(``&quot;name&quot;``,``&quot;Jack&quot;``).QsUpdate(val)``
fmt.Printf(``&quot;Matched Num: %s, %s&quot;``, num, err)``
// SET name = &quot;Bob&quot; WHERE name = &quot;Jack&quot;
</code></pre>
<h5 id="qsdelete">QsDelete</h5>
<pre><code>num, err := o.QueryTable(new(User)).WithFilter(``&quot;name&quot;``, ``&quot;Jack&quot;``).QsDelete()
fmt.Printf(``&quot;Affected Num: %s, %s&quot;``, num, err)
// DELETE FROM user WHERE name = &quot;Jack&quot;
</code></pre>
<h4 id="å…³è”æŸ¥è¯¢è¿æ¥">å…³è”æŸ¥è¯¢ï¼ˆè¿æ¥ï¼‰</h4>
<h5 id="func-s-queryset-withloadrelatedcols-string-queryset">func (s *QuerySet) WithLoadRelated(cols ...string) *QuerySet</h5>
<p>é—®é¢˜ï¼šå…³è”çš„æ—¶å€™å…ˆwithfilter.å†ä½¿ç”¨withloadrelatedå¯¹è¿™ä¸€ç»“æ„ä¸­çš„å…³è”æ•°æ®é™åˆ¶</p>
<pre><code>type ClientPatchData struct {      
    ID       string `orm:&quot;pk;size(128);column(_id);auto&quot;`
 
    ClientMeta *Meta  `orm:&quot;rel(one,ref=MetaID)&quot;`
    //MetaIDä¸º1:1å…³è”å…³ç³»å­˜å‚¨IDåˆ—ï¼Œä¸šåŠ¡æ— éœ€å…³å¿ƒæ­¤å­—æ®µä¹Ÿä¸å…è®¸æ“ä½œæ­¤å­—æ®µï¼Œæ­¤å­—æ®µç±»å‹å¿…é¡»ä¸Metaä¸»é”®ç±»å‹ä¸€è‡´
    MetaID     string `orm:&quot;size(128);column(meta_id)&quot;`
 
    Kbids   []*Kbid         `orm:&quot;rel(m2m)&quot;`
}
//æŸ¥å‡ºClientPatchData.ID=&quot;ClientPatchData_ID&quot;çš„ä¸€æ¡æ•°æ®ï¼ŒåŒæ—¶æŸ¥å‡ºä¸ä¹‹å…³è”çš„Metaå’ŒKbidæ•°æ®;å…³è”å…³ç³»çš„å»ºç«‹è¯¦çœ‹Associationç›¸å…³api
qsPatch := ``new``(ClientPatchData)
err := o.QueryTable(qsPatch).WithFilter(``&quot;ID&quot;``, ``&quot;ClientPatchData_ID&quot;``).WithLoadRelated(``&quot;ClientMeta&quot;``,``&quot;Kbids&quot;``).One(qsPatch)
</code></pre>
<h5 id="withcondè‡ªå®šä¹‰æ¡ä»¶è¡¨è¾¾å¼">withcondè‡ªå®šä¹‰æ¡ä»¶è¡¨è¾¾å¼</h5>
<pre><code>/ and AndCond (and AndNot orNot OrNotCond (and AndNot))å‡è®¾0123456789è¿™10ä¸ªå€¼
qs := o.QueryTable(user)
cond := orm.NewCondition().And(``&quot;name__contains&quot;``,``&quot;Test_Condition&quot;``))
cond1 := cond.AndNot(``&quot;age__gt&quot;``, users[3].Age).OrNot(``&quot;age__gt&quot;``, users[4].Age) ``//!(&gt;3)||!(&gt;4) ç­‰ä»·äº &lt;=3||&lt;=4     result:01234
cond2 := cond.AndNot(``&quot;age__gt&quot;``, users[5].Age)                 //!(&gt;5) ç­‰ä»·äº &lt;=5           result:012345
cond3 := cond1.OrNotCond(cond2)                        //01234||!(012345) ç­‰ä»·äº 01234||6789 result:012346789
qs.WithCond(cond.AndCond(cond3))
qs.All(userResults)                              //result:012346789
</code></pre>
<p>é¦–å…ˆè¦newconditionå¾—åˆ°ã€‚</p>
<h4 id="withjoinè¿æ¥æ“ä½œ">=<mark>Withjoinï¼šè¿æ¥æ“ä½œ</mark>=</h4>
<p>func (s *QuerySet) WithJoin( joinMode string, qsRight *QuerySet, on *Condition) *QuerySet</p>
<p>é—®é¢˜ï¼šä¸æ˜¯å¾ˆä¼š</p>
<h2 id="associationdotransaction">Associationï¼ŒDoTransactionï¼š</h2>
<p>å¯¹å…³è”æ•°æ®æ“ä½œæ—¶ï¼Œä¸¤ä¸ªè¡¨ï¼Œéœ€è¦ä½¿ç”¨äº‹åŠ¡ã€‚</p>
<pre><code>err := so.DoTransaction(func() error {
		err := so.Delete(info)
		if err != nil {
			log.Errorf(&quot;DeleteStandardMeta rule: %v error: %+v&quot;, info, err)
			return err
		}
		_, err = so.QueryTable(new(model.StandardCheck)).WithFilter(&quot;standard&quot;, info.Id).QsDelete()
		if err != nil {
			log.Errorf(&quot;DeleteStandardCheck rule: %v error: %+v&quot;, info, err)
			return err
		}
		return nil
	})
	return err
}
</code></pre>
<h5 id="æ˜¯ä¸€å¯¹ä¸€å¤šå¯¹å¤šå…³è”å…³ç³»çš„å¢åŠ æ›´æ–°åˆ é™¤ç­‰æ“ä½œæ¥å£æ¯ä¸€ä¸ªæ“ä½œéƒ½è‡ªå¸¦äº‹åŠ¡">æ˜¯ä¸€å¯¹ä¸€ï¼Œå¤šå¯¹å¤šå…³è”å…³ç³»çš„å¢åŠ ï¼Œæ›´æ–°ï¼Œåˆ é™¤ç­‰æ“ä½œæ¥å£ï¼Œæ¯ä¸€ä¸ªæ“ä½œéƒ½è‡ªå¸¦äº‹åŠ¡ã€‚</h5>
<p>1.å…ˆåˆ é™¤å…³è”å…³ç³»ï¼Œå†åˆ é™¤æ•°æ®ã€‚</p>
<p>å…ˆåˆ é™¤model.Standardï¼Œå†åˆ é™¤ç›¸å…³è”çš„model.StandardCheckã€‚</p>
<h3 id="migrationèƒ½åŠ›">Migrationèƒ½åŠ›ï¼š</h3>
<p>ä¸ºæœåŠ¡ç«¯è½¯ä»¶å‡çº§å¸¦æ¥çš„æ•°æ®åº“å­˜å‚¨å±‚é¢ï¼Œæä¾›é€šç”¨çš„æ•°æ®åº“å‡çº§ç›¸å…³çš„åŸºç¡€èƒ½åŠ›ã€‚</p>
<p>ç”¨æ¥é“¾æ¥æ•°æ®åº“ã€æ£€æŸ¥æ•°æ®åº“å­˜åœ¨ã€åˆ›å»ºæ•°æ®åº“å’Œå…³é—­æ•°æ®åº“çš„æ¥å£ã€‚</p>
<p>ä½œä¸šï¼š</p>
<ol>
<li>æ‰¾ä¸€ä¸ªç¯å¢ƒï¼ˆæœ¬åœ°æˆ–è€…å¼€å‘æœºéƒ½å¯ä»¥ï¼‰å®‰è£…mongoå’ŒPostgreSQL</li>
<li>ç”¨å‘½ä»¤è¡Œå®Œæˆæ•°æ®æ“ä½œå‘½é¢˜ï¼ˆæ‰‹å†™sqlï¼‰ï¼š
<ol>
<li>æ–°å»ºä¸€ä¸ªschoolåº“</li>
<li>æ–°å»ºstudent ï¼ˆåŒ…å«idï¼Œå§“åã€ç­çº§idã€å¹´é¾„ å­—æ®µï¼‰ å’Œ classï¼ˆåŒ…å«idï¼Œåç§°ï¼‰è¡¨ï¼Œ</li>
<li>æ’å…¥2æ¡classæ•°æ®ï¼Œ5æ¡studentæ•°æ®</li>
<li>å°†æ‰€æœ‰å­¦ç”Ÿå¹´é¾„ + 1</li>
<li>è·å–æ¯ä¸ªç­çš„å¹³å‡å¹´é¾„ã€æ€»äººæ•°ã€ç­çº§åç§°</li>
<li>åˆ é™¤ä¸€ä¸ªå­¦ç”Ÿä¿¡æ¯</li>
</ol>
</li>
</ol>
<p>é—®é¢˜ï¼š</p>
<p>\l æŸ¥çœ‹æ•°æ®åº“</p>
<p>\cè¿›å…¥æ•°æ®åº“</p>
<p>\dæŸ¥çœ‹è¡¨</p>
<p>1.æ³¨å†Œè¡¨=æ³¨å†Œæ¨¡å‹ï¼Ÿ</p>
<p>å…ˆè¦æ³¨å†Œæ¨¡å‹ï¼Œç„¶åè¿æ¥æ•°æ®åº“åã€‚æ³¨å†Œè¡¨å†æ¥ä½¿ç”¨ä½¿ç”¨è¡¨ï¼Œè¿›è¡Œæ“ä½œã€‚</p>
<p>2.æ€ä¹ˆè®¾ç½®å…³è”ï¼Ÿ</p>
<pre><code>//å­¦ç”Ÿè¡¨
type StudentOne struct {
   ID string    `orm:&quot;size(128);pk;auto&quot;`
   Name string  `orm:&quot;size(128)&quot;`
   Class *ClassOne `orm:&quot;rel(one,ref=StudentClassID)&quot;`//åªéœ€è¦å†é¡¶ä¸€ä¸ªidã€‚
   StudentClassID string`orm:&quot;size(128);colum(student_class_id)&quot;`
   Age int
   motto string
}
//ç­çº§è¡¨
type ClassOne struct {
   ID string `orm:&quot;pk;size(128);column(_id);auto&quot;`
   Name string`orm:&quot;size(128);column(name)&quot;`
}
</code></pre>
<p>CheckRelationLable check rel ref col on table student col ClassID got error</p>
<p>ä½¿ç”¨æ­¥éª¤ï¼š</p>
<p>1.è®¾ç½®æ•°æ®åº“çš„ä¿¡æ¯ingo</p>
<pre><code>initSetting := make(map[string]string)
initSetting[&quot;create_table&quot;] = &quot;true&quot;
initSetting[&quot;no-framework&quot;] = &quot;true&quot;
var info orm.OrmDbRegisterInfo
info.User = &quot;postgres&quot;
info.Psw = &quot;QAXwolaile12345&quot;
info.Host = &quot;localhost:5432&quot;
info.DbType = &quot;pg&quot;
info.DbName = &quot;school&quot;
info.Opts = initSetting
info.AliasName = &quot;default&quot;
</code></pre>
<p>2.åœ¨ormå¯¹è±¡ä¸­æ³¨å†Œæ•°æ®åº“ä¿¡æ¯ï¼Œè¿æ¥æ•°æ®åº“ã€‚</p>
<pre><code>e := orm.RegisterDataBaseWithOpt(info)
if e != nil {
   log.Println(e)
}
</code></pre>
<p>3.è¿æ¥ä»¥åï¼Œé€‰æ‹©ä½¿ç”¨çš„æ•°æ®è¡¨ï¼Œæ³¨å†Œæ¨¡å‹ã€‚</p>
<pre><code>//å­¦ç”Ÿè¡¨
type StudentOne struct {
   ID             string    `orm:&quot;size(128);pk;auto&quot;`
   Name           string    `orm:&quot;size(128)&quot;`
   Class          *ClassOne `orm:&quot;rel(one,ref=StudentClassID)&quot;`
   StudentClassID string    `orm:&quot;size(128);colum(student_class_id)&quot;`
   Age            int
   motto          string
}

//ç­çº§è¡¨
type ClassOne struct {
   ID   string `orm:&quot;pk;size(128);column(_id);auto&quot;`
   Name string `orm:&quot;size(128);column(name)&quot;`
}
</code></pre>
<pre><code>orm.RegisterModel(new(StudentOne), new(ClassOne))
</code></pre>
<p>4.æ³¨å†Œæ¨¡å‹ä»¥åï¼Œå°±é€‰æ‹©ä¸åŒçš„è¡¨è¿›è¡Œæ“ä½œï¼Œæ²¡æœ‰è¡¨åå°±è‡ªåŠ¨åˆ›å»º&quot;student_dynamic&quot;ã€‚</p>
<pre><code>e = orm.NewOrm().RegisterTable(new(StudentOne), &quot;student_dynamic&quot;)
if e != nil {
   log.Println(e)
}
</code></pre>
<p>5.è¦å¯¹ä¸åŒè¡¨è¿›è¡Œæ“ä½œæ—¶ï¼Œé¦–å…ˆå¯¹ormå¯¹è±¡è¿›è¡Œç”³è¯·ï¼Œç„¶åç”¨ormçš„usingTableè¿›è¡ŒæŒ‡å®šè¡¨åã€‚</p>
<pre><code>//ormå¯¹è±¡ç”³è¯·ï¼ˆå› ä¸ºå·²ç»æ³¨å†Œäº†ç¼ºçœæ•°æ®åº“ï¼Œæ‰€ä»¥ç›´æ¥è°ƒç”¨ï¼‰
o := orm.NewOrm()
//æŒ‡å®šè¡¨ç»“æ„
o.UsingTable(&quot;student_dynamic&quot;)
</code></pre>
<p>6.ç„¶åæ ¹æ®éœ€æ±‚è¿›è¡ŒAPIæ“ä½œã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Gitåˆå¹¶é—®é¢˜]]></title>
        <id>https://zhenxu138.github.io/edison.github.io/post/git-he-bing-wen-ti/</id>
        <link href="https://zhenxu138.github.io/edison.github.io/post/git-he-bing-wen-ti/">
        </link>
        <updated>2021-10-14T08:45:02.000Z</updated>
        <content type="html"><![CDATA[<p>1.æ–°å»ºä»“åº“<br>
å…ˆåˆ›å»ºprojectï¼Œå†åˆ›å»ºæ–‡ä»¶ã€‚</p>
<h5 id="git-global-setup">Git global setup</h5>
<pre><code>git config --global user.name &quot;zhengxurui&quot;
git config --global user.email &quot;zhengxurui@qianxin.com&quot;
</code></pre>
<h5 id="create-a-new-repository">Create a new repository</h5>
<pre><code>git clone git@git-open.qianxin-inc.cn:free/zhengxurui/sorm-demo.git
cd sorm-demo
touch README.md
git add README.md
git commit -m &quot;add README&quot;
git push -u origin master
</code></pre>
<h5 id="push-an-existing-folder">Push an existing folder</h5>
<pre><code>cd existing_folder
git init
git remote add origin git@git-open.qianxin-inc.cn:free/zhengxurui/sorm-demo.git
git add .
git commit -m &quot;Initial commit&quot;
git push -u origin master
</code></pre>
<h5 id="push-an-existing-git-repository">Push an existing Git repository</h5>
<pre><code>cd existing_repo
git remote rename origin old-origin
git remote add origin git@git-open.qianxin-inc.cn:free/zhengxurui/sorm-demo.git
git push -u origin --all
git push -u origin --tags
</code></pre>
<p>2.æ›´æ–°ä»£ç <br>
1.è¿›è¡Œè¿™ä¸ªæ­¥éª¤ä¹‹å‰è¦å®Œæˆå‰é¢çš„æ­¥éª¤<br>
2.å…³è”åˆ°è¿œç¨‹ä»“åº“ï¼šgit remote add origin åœ°å€<br>
3.å°†è¿œç¨‹åº“ä¸æœ¬åœ°åŒæ­¥åˆå¹¶ï¼šgit pull --rebase origin<br>
4.å°†æœ¬åœ°åº“çš„å†…å®¹æ¨é€åˆ°è¿œç¨‹ï¼Œä½¿ç”¨git push å‘½ä»¤ï¼šgit push -u origin</p>
<p>3.åˆ é™¤æ•°æ®<br>
$ git pull origin master  # å°†è¿œç¨‹ä»“åº“é‡Œé¢çš„é¡¹ç›®æ‹‰ä¸‹æ¥<br>
$ dir # æŸ¥çœ‹æœ‰å“ªäº›æ–‡ä»¶å¤¹<br>
$ git rm -r --cached target  # åˆ é™¤ä½ è¦åˆ é™¤çš„æ–‡ä»¶åç§°ï¼Œè¿™é‡Œæ˜¯åˆ é™¤targetæ–‡ä»¶å¤¹ï¼ˆcachedä¸ä¼šæŠŠæœ¬åœ°çš„flashviewæ–‡ä»¶å¤¹åˆ é™¤ï¼‰<br>
$ git commit -m 'åˆ é™¤äº†target' # æäº¤,æ·»åŠ æ“ä½œè¯´æ˜<br>
git push -u origin master #é‡æ–°æäº¤ï¼ˆè‹¥éœ€è¦å¯¹å…¶ä»–åˆ†æ”¯è¿›è¡Œæ“ä½œï¼Œåˆ™æŠŠmasteræ¢ä¸ºå¯¹åº”åˆ†æ”¯ï¼Œå¦‚:git push -u origin devï¼‰</p>
<p>4.å…‹éš†åˆ†æ”¯ï¼Œå¹¶æ–°å»ºåˆ†æ”¯</p>
<ol>
<li>å…‹éš†è¿œç¨‹masterä»“åº“çš„æŸä¸€ä¸ªåˆ†æ”¯</li>
</ol>
<pre><code class="language-bash">git clone -b &lt;æŒ‡å®šåˆ†æ”¯å&gt; &lt;è¿œç¨‹ä»“åº“åœ°å€&gt;
git clone -b master git@......(url)
</code></pre>
<ol start="2">
<li>æœ¬åœ°åˆ‡æ¢å¹¶æ–°å»ºåˆ†æ”¯</li>
</ol>
<pre><code class="language-bash">git checkout -b &lt;æœ¬åœ°åˆ†æ”¯å&gt;
git checkout -b personal
</code></pre>
<ol start="3">
<li>æ·»åŠ è¿œç¨‹ä¸»æœºåä¸ºpersonalçš„åˆ†æ”¯</li>
</ol>
<pre><code class="language-bash">git remote add &lt;è¿œç¨‹ä¸»æœºå&gt; &lt;gitåœ°å€&gt;
git remote add personal git@......(url)
</code></pre>
<ol start="4">
<li>å°†æœ¬åœ°çš„personalå†…å®¹ä¼ åˆ°ä¸ªäººåˆ†æ”¯ä¸Šçš„personal</li>
</ol>
<pre><code class="language-bash">git add .
git commit -m &quot;fritst&quot;
git push &lt;è¿œç¨‹ä¸»æœºå&gt;(remoteçš„åå­—) &lt;æœ¬åœ°åˆ†æ”¯å&gt;:&lt;è¿œç¨‹åˆ†æ”¯å&gt;ï¼ˆè¿œç¨‹çœŸæ­£åˆ›å»ºçš„åå­—ï¼‰
git push origin personal
</code></pre>
<p>5.mergeä»£ç <br>
1.pullä»£ç åˆ°è‡ªå·±æœ¬åœ°<br>
2.å¦‚æœæœ‰å†²çªï¼Œéœ€è¦git stashå°†è‡ªå·±çš„ä»£ç å­˜å…¥ç¼“å­˜åŒºã€‚<br>
3.ç„¶åå†æ¬¡pullè¿œç¨‹ä»£ç åˆ°å·¥ä½œåŒºé—´<br>
4.git stash popæ›´æ–°ä»£ç ï¼Œæ‰‹åŠ¨è§£å†³å†²çªã€‚<br>
5.ä¿®æ”¹åå†add commit pushï¼Œå®Œæˆä»£ç æ›´æ–°ã€‚</p>
<p>6.åˆ é™¤åˆ†æ”¯</p>
<pre><code class="language-bash">git branch -D dev/pzqu2
</code></pre>
<p>åˆ é™¤è¿œç«¯åˆ†æ”¯</p>
<pre><code class="language-bash">git push  origin --delete dev
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Lazy man ä¸ªäººåšå®¢]]></title>
        <id>https://zhenxu138.github.io/edison.github.io/post/hello-gridea/</id>
        <link href="https://zhenxu138.github.io/edison.github.io/post/hello-gridea/">
        </link>
        <updated>2018-12-11T16:00:00.000Z</updated>
        <content type="html"><![CDATA[<p>âœï¸  <strong>Gridea</strong>æœ¬äººåšå®¢ç”¨æ¥è®°å½•ä¸ªäººçš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...</p>
<p><a href="https://github.com/getgridea/gridea">Github</a></p>
<h2 id="å†…å®¹åŒ…æ‹¬">å†…å®¹åŒ…æ‹¬ğŸ‘‡</h2>
<p>ğŸ“</p>
<p>ğŸŒ‰</p>
<p>ğŸ·ï¸</p>
<p>ğŸ“‹</p>
<p>ğŸ’»</p>
<p>ğŸŒ</p>
<p>ğŸ’¬</p>
<p>ğŸŒ</p>
<p>ğŸ–¥</p>
<p>ğŸŒ±</p>
<p>ğŸƒ</p>
<p>ğŸ˜˜ Enjoy~</p>
]]></content>
    </entry>
</feed>